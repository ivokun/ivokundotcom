---
import Layout from '@layouts/Layout.astro';
import { Header } from '@components/Header';
import { marked } from 'marked';
import type { Home } from '@api/home';

const response = await fetch(`${import.meta.env.CMS_API_URL}/home?populate=*`, {
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `bearer ${import.meta.env.CMS_API_TOKEN}`,
  },
});
const { data: homeData} = await response.json();
const home: Home = homeData.attributes;
const parsedDescription = marked.parse(home.description);
const posts = [];
console.log(homeData)
---

<Layout>
  <Header />
  <main>
    <div class="border-b-[1px] py-5">
      <h1 class="text-5xl">{home.title}</h1>
      <!-- Introduction about myself -->
      <div class="text-xl mt-8 mb-2" set:html={parsedDescription} />
      <!-- List of social links -->
      <div class="flex flex-row space-x-4 text-md">
        <p>Find me on:</p>
        <a
          href="https://twitter.com/ivokun"
          target="_blank"
        >
          Twitter
        </a>
        <a
          href="https://instagram.com/ivokun"
          target="_blank"
        >
          Instagram
        </a>
        <a
          href="https://github.com/ivokun"
          target="_blank"
        >
          GitHub
        </a>
      </div>
    </div>

    <!-- List of blog posts -->
    <div class="py-5">
      <h2 class="text-3xl">Blog posts</h2>
      <ul class="mt-4">
        {
          posts && posts.length > 0 ? (
            posts.map((post) => (
              <li class="mt-4">
                <a href={post.url} class="text-blue-600 hover:text-blue-800">
                  {post.title}
                </a>
                <p class="text-gray-500 text-sm">{post.date}</p>
              </li>
            ))
          ) : (
            <li class="mt-4">
              <p class="text-gray-500 text-sm">No posts yet</p>
            </li>
          )
        }
      </ul>
    </div>
  </main>
</Layout>
